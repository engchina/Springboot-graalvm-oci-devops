version: 0.1             
component: build
timeoutInSeconds: 5000
shell: bash
env:
  exportedVariables:
    - buildId
steps:
  - type: Command
    command: |
      buildId=`echo ${OCI_BUILD_RUN_ID} | rev | cut -c 1-6 | rev`
      echo "Build ID: $buildId"
  - type: Command
    command: |
      wget https://objectstorage.eu-frankfurt-1.oraclecloud.com/p/dqtXs0f7rB65ZiPa1TopJYrpQkgpjAyo_mDu5vQhyJjWDHIai2y0QjpL5g1VDcEe/n/frsxwtjslf35/b/download/o/graalvm-ee-java11-linux-amd64-21.3.0.tar.gz
      wget https://objectstorage.eu-frankfurt-1.oraclecloud.com/p/yk30-_NDdL8Y8vw1geXCvHxijN0mTsFM2Q1mnxpt-GRws-IrcCS2-eMvVC6vxU4G/n/frsxwtjslf35/b/download/o/native-image-installable-svm-svmee-java11-linux-amd64-21.3.0.jar
      tar -xzf graalvm-ee-java11-linux-amd64-21.3.0.tar.gz
      export PATH=apache-maven-3.8.4/bin:graalvm-ee-java11-21.3.0/bin:$PATH
      export JAVA_HOME=graalvm-ee-java11-21.3.0
      java -version
      gu install -L native-image-installable-svm-svmee-java11-linux-amd64-21.3.0.jar
      ./mvnw package
      sh build.sh
      docker login fra.ocir.io -u 'frsxwtjslf35/oracleidentitycloudservice/mika.rinne@oracle.com' -p 'Y}SMSjCO02X5o){e.(-K'
      docker build -t fra.ocir.io/frsxwtjslf35/springboot-graal-ee-native:$buildId .
      docker push fra.ocir.io/frsxwtjslf35/springboot-graal-ee-native:$buildId
      